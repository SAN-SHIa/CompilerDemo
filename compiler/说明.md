安装

flex、bison、GraphViz、MSYS2
并全部添加到系统路径下

文件结构：
├── ast.c            - 抽象语法树实现
├── ast.h            - 抽象语法树结构定义
├── lexer.l          - 词法分析器（Flex）
├── makefile.win     - 项目构建脚本
├── parser.y         - 语法分析器（Bison）
├── semantic.c       - 语义分析实现
├── semantic.h       - 语义分析接口定义
├── symbol_table.c   - 符号表实现
├── symbol_table.h   - 符号表结构定义
├── ir.c             - 中间代码生成实现
├── ir.h             - 中间代码表示定义
├── optimize.c       - 代码优化器实现
├── optimize.h       - 代码优化器接口定义
├── codegen.c        - 目标代码生成实现
├── codegen.h        - 目标代码生成接口定义
└── test.c           - 测试用例




先运行

mingw32-make -f makefile.win

说明：生成的ast.dot是抽象语法树的.dot文件，ast.png是对应生成的抽象语法树图，compiler.exe是最终的编译器前端


再运行

.\compiler.exe test.c   

编译test.c中的c语言代码

编译器将生成以下输出文件：
- output.s      - 伪汇编代码（教学用）
- output.c      - 生成的C代码
- output_x64.s  - x86-64汇编代码



已实现的主要功能：

1. **词法分析（Lexer）**
   - 识别关键字：int、float、return、if、else、while
   - 识别标识符（变量名）和常量（整数、浮点数）
   - 识别各种运算符（=, +, -, *, /, ==, !=, <, >, <=, >=）
   - 识别分隔符（括号、大括号、分号等）
   - 过滤空白字符，报告非法字符

2. **语法分析（Parser）**
   - 支持函数定义（目前仅支持无参数函数）
   - 支持变量声明与初始化
   - 支持赋值语句
   - 支持条件语句（if-else）
   - 支持循环语句（while）
   - 支持复合语句（代码块）
   - 支持返回语句
   - 支持各种表达式（算术运算、比较运算）
   - 解决了经典的dangling-else问题

3. **抽象语法树（AST）**
   - 设计了完整的AST节点类型体系
   - 实现了AST的构建、遍历和打印
   - 支持生成DOT格式图形文件并转换为PNG图像
   - 实现了正确的内存管理（创建和释放）

4. **符号表管理**
   - 多级作用域的符号表
   - 支持变量和函数类型的符号
   - 支持基本数据类型：int和float
   - 实现作用域进入/离开机制
   - 符号查找（全局和当前作用域）
   - 符号表可视化打印

5. **语义分析**
   - 类型检查系统
   - 变量声明和使用检查
   - 类型兼容性检查
   - 隐式类型转换（int到float，以及float到int带警告）
   - 返回类型与函数声明一致性检查
   - 详细的错误报告机制

6. **中间代码生成**
   - 三地址码风格的中间表示
   - 支持基本算术和逻辑运算
   - 支持变量加载和存储
   - 支持条件跳转和无条件跳转
   - 支持函数调用框架
   - 自动类型转换处理
   - 临时变量管理

7. **代码优化**
   - 常量折叠优化
   - 常量传播优化
   - 代数简化（如x+0=x, x*1=x等）
   - 死代码消除
   - 复制传播
   - 公共子表达式消除（基础版）
   - 多遍优化策略
   - 可配置的优化级别

8. **目标代码生成**
   - 支持多种目标架构
   - 伪汇编代码生成（教学用）
   - x86-64汇编代码生成
   - C代码生成
   - 寄存器分配（基础版）
   - 指令选择和调度
   - 函数序言和尾声生成

具体效果

1. **编译流程**
   - 读取源文件(test.c)
   - 进行词法分析，生成token流
   - 进行语法分析，构建AST
   - 打印AST结构（文本形式）
   - 生成AST可视化图像(ast.png)
   - 执行语义分析，检查程序正确性
   - 生成中间代码（三地址码）
   - 执行代码优化
   - 生成目标代码（多种格式）
   - 输出分析结果和发现的错误

2. **错误检测**
   - 检测未声明变量的使用
   - 检测变量重复声明
   - 检测类型不匹配
   - 检测返回值类型不匹配
   - 丰富的错误提示信息

3. **测试示例**
   - test.c演示了基本的C语言构造
   - 包含变量声明、初始化、算术运算
   - 条件分支、循环
   - 类型转换（int和float之间）

4. **可视化输出**
   - 生成语法树的图形化表示
   - 打印格式化的符号表
   - 详细的编译过程信息
   - 中间代码可视化
   - 优化统计信息

5. **生成的中间代码示例**
   ```
   func_begin main
   x = 10
   y = 5.50
   t1 = x
   t2 = y
   t3 = t1 * t2
   t4 = x
   t5 = y
   t6 = t4 - t5
   t7 = t3 + t6
   result = t7
   t8 = result
   t9 = (float) t8
   t10 = t9 > 40.00
   if !t10 goto L1
   t11 = result
   return t11
   goto L2
   L1:
   t12 = result
   t13 = (float) t12
   t14 = t13 * 2.00
   t15 = (int) t14
   result = t15
   L2:
   L3:
   t16 = result
   t17 = (float) t16
   t18 = t17 < 100.00
   if !t18 goto L4
   t19 = result
   t20 = (float) t19
   t21 = t20 + 10.50
   t22 = (int) t21
   result = t22
   goto L3
   L4:
   t23 = result
   return t23
   func_end
   ```

补充说明：
1、使用GB编码
2、现已实现完整的编译器前端和后端框架
3、支持从源代码到目标代码的完整编译流程
4、包含中间代码优化功能
5、可生成多种格式的目标代码